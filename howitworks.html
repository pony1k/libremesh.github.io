<!doctype html>

<!--[if IE 9]>
<html class="lt-ie10" lang="en"> <![endif]-->
<html lang="en" class="no-js" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>How it works</title>


    <meta name="description"
          content="The LibreMesh project, a set of tools for making the free networks possible"/>
	
    <link rel="stylesheet" href="/css/foundation.css"/>
    <link rel="stylesheet" href="/css/font-awesome.css"/>
    <link rel="stylesheet" href="/css/coderay.css"/>
    <link rel="stylesheet" href="/css/asciidoctor.css"/>
    <link rel="stylesheet" href="/css/lime.css"/>
    <script src="/js/vendor/modernizr.js"></script>
    <script src="/js/toc.js"></script>

</head>
<body>


<!-- Nav Bar -->

<nav class="top-bar" data-topbar>
    <ul class="title-area">
        <!-- Title Area -->
        <li class="name">
            <h1>
                <a href="">
                    <img src="/logo/logo_nano.png"></img>
                    <span class="top-bar-title">LibreMesh</span>
                </a>
            </h1>
        </li>
	<li class="toggle-topbar menu-icon"><a href=""><span>Menu</span></a></li>
    </ul>
    
<!-- lang --> 
<ul class="lng">





  <li>
    <a href="/howitworks.html" class="en">en</a>
  </li>

  <li>
    <a href="/es_howitworks.html" class="es">es</a>
  </li>

  <li>
    <a href="/pt-br_howitworks.html" class="pt-br">pt-br</a>
  </li>

    </ul>
<!-- fine lang-->

    <section class="top-bar-section">
        <!-- Right Nav Section -->
        <ul class="right">
            
    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/">Home</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/news.html">News</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/communication.html">Communication</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/getit.html">Get it!</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li  class="active"><a href="/howitworks.html">How it works</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/development.html">Development</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/docs/">Documentation</a></li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li ><a href="/about.html">About</a></li>


        </ul>
    </section>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->

<div class="row">
    <!-- Docs Sidebar -->

    

    <!-- End Docs Sidebar -->

    <!-- Main Blog Content -->
    <div class="large-9 columns" role="content">

        <div class="sectionbody ">
            
            <div class="paragraph text-right">
                <p>
                    <span class="icon"><i class="fa fa-edit"></i></span>
                    <a href="https://github.com/libremesh/libremesh.github.io/edit/master/howitworks.txt">Edit this page</a>
                </p>
            </div>
        </div>

        <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#objectives_to_achieve">Objectives to Achieve</a></li>
<li><a href="#the_basics">The Basics</a>
<ul class="sectlevel2">
<li><a href="#cloud_layer_2">Cloud layer 2</a></li>
<li><a href="#network_layer_3">Network layer 3</a></li>
<li><a href="#mixing_layers">Mixing layers</a></li>
</ul>
</li>
<li><a href="#the_details">The Details</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="objectives_to_achieve">Objectives to Achieve</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Enable non-expert users to set up a mesh network and perform basic configuration and management via a web interface usable on smartphones</p>
</li>
<li>
<p>Encourage non-expert users to empower themselves deepening their technical understanding of mesh networks</p>
</li>
<li>
<p>Scalability</p>
</li>
<li>
<p>Network segmentation</p>
</li>
<li>
<p>Layer 2 roaming inside certain areas</p>
</li>
<li>
<p>Smart gateway selection with redundancy and possibility of user-choice</p>
</li>
<li>
<p>Compatibility of most of the existing scenarios</p>
</li>
<li>
<p>A single firmware image for all of your network (for ground level, for backbone, for companies, for quick deployments, etc.)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_basics">The Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The network architecture designed for LibreMesh is based on two layers:</p>
</div>
<div class="sect2">
<h3 id="cloud_layer_2">Cloud layer 2</h3>
<div class="paragraph">
<p>The cloud layer 2 uses the dynamic routing protocol BATMAN-ADV</p>
</div>
<div class="imageblock left">
<div class="content">
<img src="img/bat-adv.png" alt="batmanadv" width="100">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>B.A.T.M.A.N. Advanced is a mesh routing protocol that runs in kernel space.
Even if the network topology is made of multiple nodes and multiple hops, B.A.T.M.A.N. Advanced abstracts it to a single layer 2 broadcast domain.
So from the user&#8217;s perspective the entire mesh will look like a single LAN.
This architecture is robust for roaming purposes, thus TCP and UDP connections are not lost even when moving and changing access points (AP&#8217;s).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="network_layer_3">Network layer 3</h3>
<div class="paragraph">
<p>The whole network layer 3 uses by default the routing protocol BMX</p>
</div>
<div class="imageblock left">
<div class="content">
<img src="img/bmx7.png" alt="bmx7" width="100">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>BMX6 (or the new version BMX7) is an IPv6 native dynamic routing protocol which offers very advanced features and a small
network overhead, thanks to the distance-vector strategy and its set of optimizations. Version 7 has, in addition, security routing extensions.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mixing_layers">Mixing layers</h3>
<div class="paragraph">
<p>By default, all nodes are running both routing protocols (BMX and BAT-ADV), but on different VLANs.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.
So the routing is isolated by the MAC layer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The BMX VLAN is always the same, so all link-layer connected nodes will see each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The BATADV VLAN depends on the cloud identifier which is calculated (by default) using the AP SSID.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The BMX network will be a single one for all of the mesh, but the BAT-ADV network may be split across several clouds.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/network1.png" alt="network1">
</div>
</div>
<div class="paragraph">
<p><strong>This configuration isolates the layer 2 clouds</strong>.
For instance a neighborhood, a company complex, or a street level hotspot network may choose to isolate their LAN from the rest of the network.
However at the same time, they will be able to reach the rest of the nodes using the layer 3 routed network.</p>
</div>
<div class="paragraph">
<p>Roaming will be available inside the cloud, so TCP sessions, video streaming, or even a SIP call can be done while moving around.
On the other hand, thanks to layer 3 segmentation, the common problems found in a layer 2 bridged network&#8201;&#8212;&#8201;such as Broadcast storms or DHCP nightmares&#8201;&#8212;&#8201;will not disturb the correct operation of the network.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Everything is automatic and transparent for the end user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/network2.png" alt="network2">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_details">The Details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WiFi Access Points of the same cloud share common parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SSID (the WiFi AP identification name)</p>
</li>
<li>
<p>Special anycast.<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> IPv4 and IPv6 addresses</p>
</li>
<li>
<p>A special anycast MAC address</p>
</li>
<li>
<p>The DHCP/RA server to provide valid IPs from the cloud to the clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus a client attached to an AP can move around the mesh without the need to renew their IP configuration.
Even the MAC layer will be the same from their point of view.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/network3.png" alt="network3">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The DHCP lease file is shared among the cloud to prevent collisions using
<a href="http://en.wiki.guifi.net/wiki/A.L.F.R.E.D.">A.L.F.R.E.D.</a></p>
</div>
<div class="paragraph">
<p>As long as all nodes share the same anycast MAC/IP, from the client point of view it is fully transparent.
The gateway is always the same even though the mesh node (where they are attached) may change.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/network4.png" alt="network4">
</div>
</div>
<div class="paragraph">
<p>When a client wants to go out from the LAN (cloud) to reach the Internet or any other network,
it will send the packets to the special anycast gateway address.  The node where the client
is physically attached will take care of this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An ebtables.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup> rule in the LAN/AP bridge prevents
packets sent to the anycast address from propagating through the cloud.  The mesh node where the client
is associated gets the packet but not the other nodes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/network5.png" alt="network5">
</div>
</div>
<div class="paragraph">
<p>The packet is routed through the BMX layer 3 network to the best Internet gateway. It may be a node from the same cloud or any other from another cloud far away.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BMX has a powerful smart gateway functionality which automatically selects the best Internet gateway node taking into account the available bandwidth.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/network6.png" alt="network6">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On the way back the packet will arrive to some node in the cloud but it might not be the same node.
Nevertheless the packet will be correctly delivered to the originator.
This is because BMX smart gateway uses 1-way tunnels to ensure the selected gateway is used.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Virtual isolated LAN, for instance wlan0.13
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. IP shared by multiple devices in the network
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. something like iptables but for network layer 2
</div>
</div>

    </div>

    <!-- End Main Content -->

    <!-- Sidebar -->

    
    <aside class="large-3 columns">
        <h4>Links</h4>
<div class="panel">
    <ul class="fa-ul">
        <li><i class="fa-li fa fa-download" aria-hidden="true"></i><a href="https://downloads.libremesh.org/current/">Latest Release Firmware</a></li>
        <li><i class="fa-li fa fa-linux" aria-hidden="true"></i><a href="development.html">Build Firmware Locally</a></li>
        <li><i class="fa-li fa fa-code-fork" aria-hidden="true"></i><a href="https://github.com/libremesh/">Source Code</a></li>
        <li><i class="fa-li fa fa-envelope" aria-hidden="true"></i><a href="https://www.autistici.org/mailman/listinfo/libremesh">Mailing List</a></li>
        <li><i class="fa-li fa fa-comments" aria-hidden="true"></i><a href="https://matrix.to/#/#libremesh-dev:matrix.guifi.net">Element Chatroom</a></li>
    </ul>
</div>

    </aside>
    

    <!-- End Sidebar -->
</div>

<!-- End Main Content and Sidebar -->


<!-- Footer -->

<footer class="row">
    <div class="large-12 columns">
        <hr/>
        <div class="row">
            <div class="large-12 columns">
                <p>Last updated 2023-12-01 13:47:38</p>
            </div>
        </div>
    </div>
</footer>

<script src="/js/vendor/jquery.js"></script>
<script src="/js/foundation.min.js"></script>
<script>
    $(document).foundation();

    var doc = document.documentElement;
    doc.setAttribute('data-useragent', navigator.userAgent);
</script>
</body>
</html>
